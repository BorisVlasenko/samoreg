# Веб-приложение для регистрации на мероприятия

## Обзор проекта

Веб-приложение для самостоятельной регистрации на однодневные мероприятия с системой временных слотов. Разработано на Flask (Python) с использованием SQLite для хранения данных.

## Функциональность

### Административная панель
- **URL:** `/admin/{хеш}` (хеш генерируется автоматически)
- **Пароль по умолчанию:** `admin123` (можно изменить в `app.py`)
- Создание мероприятий с указанием:
  - Названия, даты
  - Времени начала/окончания
  - Длительности временного слота
  - Перерывов (если есть)
- Автоматическая генерация уникальной секретной ссылки для регистрации
- Просмотр списка зарегистрированных участников
- Управление мероприятиями: закрытие регистрации, удаление

### Публичная страница регистрации
- **URL:** `/register/{event_hash}`
- Форма ввода данных с автоматической валидацией:
  - Имя и фамилия ребенка (автоматическое приведение к правильному регистру)
  - Номер телефона (только 10 цифр, без 8 и +7)
- Таблица временных слотов с цветовой индикацией:
  - **Белый** - свободные слоты
  - **Синий** - занятые слоты (с номером телефона)
  - **Зеленый** - ваш слот (при повторном входе)
- Проверка доступности слота на сервере при регистрации
- Автоматическое сохранение регистрации

## Технический стек

- **Backend:** Flask 3.1.2
- **Database:** SQLite (файл `events.db`)
- **Frontend:** Vanilla JavaScript, HTML, CSS
- **Python:** 3.11
- **Конфигурация:** Файл config.txt

## Структура проекта

```
├── app.py                 # Главный файл Flask приложения
├── templates/
│   ├── admin.html        # Страница администратора
│   └── register.html     # Страница регистрации для родителей
├── static/               # Статические файлы (пусто в текущей версии)
├── events.db             # База данных SQLite (создается автоматически)
├── pyproject.toml        # Зависимости Python
└── uv.lock              # Lock-файл зависимостей
```

## База данных

### Таблица `events`
- `id` - уникальный идентификатор
- `title` - название мероприятия
- `event_date` - дата мероприятия
- `start_time` / `end_time` - временные рамки
- `slot_duration` - длительность слота в минутах
- `breaks` - JSON с перерывами
- `registration_open` - статус регистрации (открыта/закрыта)
- `event_hash` - уникальный хеш для ссылки

### Таблица `registrations`
- `id` - уникальный идентификатор
- `event_id` - связь с мероприятием
- `child_name` - имя ребенка
- `phone` - номер телефона родителя
- `slot_time` - зарегистрированное время
- `registered_at` - время регистрации

## API Endpoints

### Административные
- `POST /api/admin/login` - вход администратора
- `GET /api/admin/events` - список мероприятий на сегодня
- `GET /api/admin/events/{id}/registrations` - список участников
- `POST /api/admin/events` - создание мероприятия
- `POST /api/admin/events/{id}/toggle` - открыть/закрыть регистрацию
- `DELETE /api/admin/events/{id}` - удаление мероприятия

### Публичные
- `GET /api/event/{hash}` - информация о мероприятии
- `GET /api/event/{hash}/slots` - список временных слотов
- `POST /api/event/{hash}/register` - регистрация на слот
- `GET /api/event/{hash}/my-registration` - проверка своей регистрации

## Особенности реализации

1. **Валидация номера телефона:** Только цифры, запрет на ввод других символов через JavaScript
2. **Автоматическое приведение регистра:** Первая буква имени и фамилии заглавная
3. **Проверка доступности слота:** Race condition защита через UNIQUE constraint в БД
4. **CORS настроен** для работы в iframe на сайтах Tilda
5. **Копирование ссылки в буфер:** Одним кликом через Clipboard API

## Развертывание на Tilda

Для встраивания формы регистрации на сайт Tilda используйте iframe:

```html
<iframe src="https://your-repl-url/register/{event_hash}" 
        width="100%" 
        height="800" 
        frameborder="0">
</iframe>
```

## Запуск приложения

Приложение автоматически запускается через Replit Workflow на порту 5000.

Для локального запуска:
```bash
python app.py
```

## Настройка

### Переменные окружения

Для безопасной работы приложения рекомендуется настроить следующие переменные окружения:

- `ADMIN_PASSWORD` - пароль администратора (по умолчанию: `admin123`)
- `ADMIN_URL_SECRET` - секретная строка для генерации URL администратора (по умолчанию: `admin_secret_change_me`)
- `SESSION_SECRET` - секретный ключ для сессий Flask (генерируется автоматически)

**Важно:** Измените значения по умолчанию в продакшене для обеспечения безопасности!

### Как установить переменные окружения в Replit

1. Откройте панель "Secrets" в Replit
2. Добавьте секреты:
   - `ADMIN_PASSWORD` = ваш_надежный_пароль
   - `ADMIN_URL_SECRET` = ваша_секретная_строка
   - `SESSION_SECRET` уже установлен автоматически

После установки переменных окружения перезапустите приложение.

## Следующие шаги (опционально)

- Добавить фильтр мероприятий по дате (не только сегодняшние)
- Экспорт списка участников в CSV/Excel
- Редактирование созданных мероприятий
- Уведомления администратора при новой регистрации
- Перенос участника на другой слот через админ-панель

## Дата создания

17 октября 2025

## Автор

Разработано с помощью Replit Agent
